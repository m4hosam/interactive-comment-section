<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="css/style2.css">
    <link
        href="https://fonts.googleapis.com/css2?family=Kumbh+Sans:wght@400;700&family=Rubik:wght@400;500;700&display=swap"
        rel="stylesheet">
    <title>Comments</title>
</head>

<body>

    <div class="reply-card">
        <img src="images/avatars/image-<%= currentUsername %>.png" alt="">
        <form action="/reply" method="post">
            <textarea name="content" class="replyed-comment">@user name, </textarea>
            <input type="text" class="repliedAt" name="repliedAt" style="display: none;">
            <input type="text" class="commentId" name="commentId" style="display: none;">
            <button name="username" value="<%= currentUsername %>">REPLY</button>
        </form>
    </div>

    <div class="container">
        <% for(let i=0 ;i < data.length ; i++){ %>
            <div class="basic-card">
                <form class="score" action="/score" method="post">
                    <button name="op" value="add" class="controller add" type="submit">+</button>
                    <input name="commentId" value="<%= data[i]._id.valueOf() %>" type="text" style="display: none;">
                    <div class="score-value">
                        <%= data[i].score %>
                    </div>
                    <button name="op" value="minus" class="controller minus" type="submit">–</button>
                </form>
                <div class="content">
                    <div class="card-header">
                        <img class="avatar" src="images/avatars/image-<%= data[i].username %>.png" alt="">
                        <h5>
                            <%= data[i].username %>
                        </h5>
                        <h6>
                            <%= data[i].createdAt %>
                        </h6>
                        <div class="reply" name="<%= data[i].username %>" id="<%= data[i]._id.valueOf() %>">
                            <img src="images/icon-reply.svg" alt="">
                            Reply
                        </div>
                    </div>
                    <p>
                        <%= data[i].content %>
                    </p>
                </div>
            </div>
            <% if(data[i].replies.length> 0){ %>
                <!-- Replies Part -->
                <div class="container-fluid">
                    <!-- part of replies -->
                    <% for(let j=0 ; j < data[i].replies.length ; j++){ %>
                        <div class="basic-card">
                            <form class="score" action="/score" method="post">
                                <button name="op" value="add" class="controller add" type="submit">+</button>
                                <input name="commentId" value="<%= data[i].replies[j]._id.valueOf() %>" type="text"
                                    style="display: none;">
                                <div class="score-value">
                                    <%= data[i].replies[j].score %>
                                </div>
                                <button name="op" value="minus" class="controller minus" type="submit">–</button>
                            </form>
                            <div class="content">
                                <div class="card-header">
                                    <img class="avatar"
                                        src="images/avatars/image-<%= data[i].replies[j].username %>.png" alt="">
                                    <h5>
                                        <%= data[i].replies[j].username %>
                                    </h5>
                                    <h6>
                                        <%= data[i].replies[j].createdAt %>
                                    </h6>
                                    <div class="reply" name="<%= data[i].replies[j].username %>"
                                        id="<%= data[i]._id.valueOf() %>">
                                        <img src="images/icon-reply.svg" alt="">
                                        Reply
                                    </div>
                                </div>
                                <p>
                                    <%= data[i].replies[j].content %>
                                </p>
                            </div>
                        </div>
                        <% } %>
                </div>

                <% } %>
                    <% } %>
                        <div class="reply-card send-card">
                            <img src="images/avatars/image-<%= currentUsername %>.png" alt="">
                            <form action="/newComment" method="post">
                                <textarea name="content" id="newComment"></textarea>
                                <button name="username" value="<%= currentUsername %>">SEND</button>
                            </form>
                        </div>



    </div>
    <script src="js/app.js"></script>
</body>

</html>